<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Kanban Board</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        // Apply theme immediately to prevent flash
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
</head>
<body>
    <div class="app">
        <!-- Authentication Screen -->
        <div id="auth-screen" class="auth-screen">
            <div class="auth-container">
                <div class="auth-header">
                    <div class="auth-header-content">
                        <h1 class="auth-title">
                            <i class="fas fa-columns"></i>
                            Simple Kanban Board
                        </h1>
                        <button class="theme-toggle" id="auth-theme-toggle" title="Toggle dark mode">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                    <p class="auth-subtitle">Organize your tasks with ease</p>
                </div>

                <!-- Login Form -->
                <div id="login-form" class="auth-form">
                    <h2>Sign In</h2>
                    <form id="login-email-form">
                        <div class="form-group">
                            <label for="login-email">Email</label>
                            <input type="email" id="login-email" name="email" required placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" name="password" required placeholder="Enter your password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">
                            <i class="fas fa-sign-in-alt"></i>
                            Sign In
                        </button>
                    </form>

                    <div class="auth-divider">
                        <span>or</span>
                    </div>

                    <button id="google-login-btn" class="btn btn-google btn-full">
                        <i class="fab fa-google"></i>
                        Continue with Google
                    </button>

                    <div class="auth-switch">
                        <p>Don't have an account? <a href="#" id="show-signup">Sign up</a></p>
                    </div>
                </div>

                <!-- Signup Form -->
                <div id="signup-form" class="auth-form" style="display: none;">
                    <h2>Create Account</h2>
                    <form id="signup-email-form">
                        <div class="form-group">
                            <label for="signup-username">Username</label>
                            <input type="text" id="signup-username" name="username" required placeholder="Choose a username">
                        </div>
                        <div class="form-group">
                            <label for="signup-email">Email</label>
                            <input type="email" id="signup-email" name="email" required placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="signup-fullname">Full Name</label>
                            <input type="text" id="signup-fullname" name="full_name" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" name="password" required placeholder="Create a password">
                        </div>
                        <div class="form-group">
                            <label for="signup-confirm-password">Confirm Password</label>
                            <input type="password" id="signup-confirm-password" name="confirm_password" required placeholder="Confirm your password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">
                            <i class="fas fa-user-plus"></i>
                            Create Account
                        </button>
                    </form>

                    <div class="auth-divider">
                        <span>or</span>
                    </div>

                    <button id="google-signup-btn" class="btn btn-google btn-full">
                        <i class="fab fa-google"></i>
                        Sign up with Google
                    </button>

                    <div class="auth-switch">
                        <p>Already have an account? <a href="#" id="show-login">Sign in</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application (hidden initially) -->
        <div id="main-app" class="main-app" style="display: none;">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <div class="header-nav-left">
                        <a href="/" class="home-btn" title="Home">
                            <i class="fas fa-home"></i>
                        </a>
                        <h1 class="app-title">
                            <i class="fas fa-columns"></i>
                            Simple Kanban Board
                        </h1>
                    </div>
                    <button class="btn btn-primary" id="new-board-btn">
                        <i class="fas fa-plus"></i>
                        New Board
                    </button>
                    <div class="board-selector">
                        <select id="board-select" class="board-select">
                            <option value="">Select a board...</option>
                        </select>
                    </div>
                    <div class="header-actions">
                        <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode">
                            <i class="fas fa-moon"></i>
                        </button>
                        <div class="user-menu">
                            <button class="btn btn-secondary" id="user-menu-btn">
                                <i class="fas fa-user"></i>
                                <span id="user-name">User</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div id="user-dropdown" class="user-dropdown" style="display: none;">
                                <a href="#" id="user-profile">
                                    <i class="fas fa-user-cog"></i>
                                    Profile
                                </a>
                                <a href="/static/api-keys.html" id="api-keys-menu">
                                    <i class="fas fa-key"></i>
                                    API Keys
                                </a>
                                <a href="/static/groups.html" id="groups-menu">
                                    <i class="fas fa-users"></i>
                                    Groups
                                </a>
                                <a href="/admin" id="admin-panel" style="display: none;">
                                    <i class="fas fa-users-cog"></i>
                                    Admin Panel
                                </a>
                                <a href="#" id="user-logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </header>

            <!-- Main Content -->
        <main class="main-content">
            <!-- Loading State -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Loading kanban board...</p>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-content">
                    <i class="fas fa-clipboard-list"></i>
                    <h2>No Board Selected</h2>
                    <p>Create a new board or select an existing one to get started.</p>
                    <button class="btn btn-primary" id="create-first-board">
                        <i class="fas fa-plus"></i>
                        Create Your First Board
                    </button>
                </div>
            </div>

            <!-- Kanban Board -->
            <div id="kanban-board" class="kanban-board" style="display: none;">
                <div class="board-header">
                    <div class="board-info">
                        <h2 id="board-title">Board Title</h2>
                        <p id="board-description">Board description</p>
                    </div>
                    <div class="board-actions">
                        <button class="btn btn-primary" id="add-column-btn">
                            <i class="fas fa-plus"></i>
                            Add Column
                        </button>
                        <button class="btn btn-secondary" id="edit-board-btn">
                            <i class="fas fa-edit"></i>
                            Edit Board
                        </button>
                    </div>
                </div>

                <div class="columns-container" id="columns-container">
                    <!-- Columns will be dynamically generated here -->
                </div>
            </div>
        </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- New Board Modal -->
    <div id="board-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="board-modal-title">Create New Board</h3>
                <button class="modal-close" id="board-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="board-form">
                <div class="form-group">
                    <label for="board-name">Board Name</label>
                    <input type="text" id="board-name" name="name" required placeholder="Enter board name">
                </div>
                <div class="form-group">
                    <label for="board-desc">Description (optional)</label>
                    <textarea id="board-desc" name="description" placeholder="Enter board description"></textarea>
                </div>
                <div class="modal-actions">
                    <div class="modal-actions-left">
                        <button type="button" class="btn btn-danger" id="board-delete" style="display: none;">
                            <i class="fas fa-trash"></i>
                            Delete Board
                        </button>
                    </div>
                    <div class="modal-actions-right">
                        <button type="button" class="btn btn-secondary" id="board-cancel">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="board-submit">Create Board</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Column Modal -->
    <div id="column-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="column-modal-title">Add Column</h3>
                <button class="modal-close" id="column-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="column-form">
                <div class="form-group">
                    <label for="column-name">Column Name</label>
                    <input type="text" id="column-name" name="name" required placeholder="Enter column name (e.g., To Do, In Progress, Done)">
                </div>
                <div class="form-group">
                    <label for="column-position">Position</label>
                    <input type="number" id="column-position" name="position" min="0" placeholder="Leave empty to add at end">
                    <small class="form-help">Position 0 is leftmost. Leave empty to add at the end.</small>
                </div>
                <div class="modal-actions">
                    <div class="modal-actions-right">
                        <button type="button" class="btn btn-secondary" id="column-cancel">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="column-submit">Add Column</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" id="task-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="task-form">
                <div class="form-group modal-title-group">
                    <label for="task-title">Task Title</label>
                    <input type="text" id="task-title" name="title" required placeholder="Enter task title">
                </div>
                <div class="form-group">
                    <label for="task-desc">Description (optional)</label>
                    <textarea id="task-desc" name="description" placeholder="Enter task description"></textarea>
                </div>
                <div class="form-group">
                    <label>Comments</label>
                    <div id="comments-section">
                        <div id="comments-list"></div>
                        <div class="comment-form">
                            <textarea id="new-comment" placeholder="Add a comment..." rows="2"></textarea>
                            <button type="button" id="add-comment-btn" class="btn btn-secondary">Add Comment</button>
                        </div>
                    </div>
                </div>
                <input type="hidden" id="task-column-id" name="column_id">
                <input type="hidden" id="task-id" name="id">
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="task-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="task-submit">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- API Keys Modal -->
    <div id="api-keys-modal" class="modal">
        <div class="modal-content api-keys-modal-content">
            <div class="modal-header">
                <h3>API Keys Management</h3>
                <button class="modal-close" id="api-keys-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="api-keys-section">
                    <div class="section-header">
                        <h4>Your API Keys</h4>
                        <button class="btn btn-primary" id="create-api-key-btn">
                            <i class="fas fa-plus"></i>
                            Create New Key
                        </button>
                    </div>
                    
                    <div id="api-keys-list" class="api-keys-list">
                        <div class="loading-state" id="api-keys-loading">
                            <div class="spinner"></div>
                            <p>Loading API keys...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create API Key Modal -->
    <div id="create-api-key-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New API Key</h3>
                <button class="modal-close" id="create-api-key-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="create-api-key-form">
                <div class="form-group">
                    <label for="api-key-name">Name *</label>
                    <input type="text" id="api-key-name" name="name" required placeholder="Enter API key name">
                </div>
                <div class="form-group">
                    <label for="api-key-description">Description</label>
                    <textarea id="api-key-description" name="description" placeholder="Enter API key description (optional)"></textarea>
                </div>
                <div class="form-group">
                    <label>Scopes *</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="scopes" value="read" checked>
                            <span class="checkmark"></span>
                            Read - View boards, tasks, and groups
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="scopes" value="write">
                            <span class="checkmark"></span>
                            Write - Create and modify boards, tasks, and groups
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="scopes" value="docs">
                            <span class="checkmark"></span>
                            Docs - Access API documentation
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="scopes" value="admin">
                            <span class="checkmark"></span>
                            Admin - Full administrative access
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="api-key-expires">Expires In</label>
                    <select id="api-key-expires" name="expires_in_days">
                        <option value="">Never expires</option>
                        <option value="7">7 days</option>
                        <option value="30" selected>30 days</option>
                        <option value="90">90 days</option>
                        <option value="365">1 year</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="create-api-key-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="create-api-key-submit">Create API Key</button>
                </div>
            </form>
        </div>
    </div>

    <!-- API Key Created Modal -->
    <div id="api-key-created-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>API Key Created Successfully</h3>
                <button class="modal-close" id="api-key-created-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="api-key-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p><strong>Important:</strong> This is the only time you'll see this key. Store it securely!</p>
                </div>
                <div class="api-key-display">
                    <label>Your API Key:</label>
                    <div class="api-key-value">
                        <input type="text" id="created-api-key-value" readonly>
                        <button class="btn btn-secondary" id="copy-api-key-btn" title="Copy to clipboard">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div class="api-key-info">
                    <div class="info-row">
                        <span class="label">Name:</span>
                        <span id="created-key-name"></span>
                    </div>
                    <div class="info-row">
                        <span class="label">Scopes:</span>
                        <span id="created-key-scopes"></span>
                    </div>
                    <div class="info-row">
                        <span class="label">Expires:</span>
                        <span id="created-key-expires"></span>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="api-key-created-done">Done</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <span id="notification-message"></span>
            <button id="notification-close" class="notification-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script src="/static/theme.js"></script>
    <script src="/static/debug.js"></script>
    <script src="/static/auth.js"></script>
    <script src="/static/api-keys.js"></script>
    <script src="/static/groups.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
